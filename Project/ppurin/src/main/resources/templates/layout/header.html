<div th:fragment="header">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container px-4 px-lg-5 d-flex justify-content-between align-items-center">
            <!-- ë¡œê³  ë° ë©”ë‰´ -->
            <div class="d-flex align-items-center">
                <!-- ë¡œê³  -->
                <a class="navbar-brand" th:href="@{/index}" style="font-weight: bold; color: #333; font-size: 1.5rem;">
                    ë¿Œë¦°ì€ ê°•ì¥ ğŸ¾
                </a>
                <!-- ë©”ë‰´ -->
                <ul class="navbar-nav ms-4 d-flex flex-row">
                    <li class="nav-item">
                        <a class="nav-link px-3 py-1 rounded" th:href="@{/index}" style="color: #555; font-size: 1rem; font-weight: 500;">
                            ğŸ  í™ˆí˜ì´ì§€
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link px-3 py-1 rounded" th:href="@{/gallery}" style="color: #555; font-size: 1rem; font-weight: 500;">
                            ğŸ“¸ ì‚¬ì§„ì²©
                        </a>
                    </li>
                </ul>
            </div>

            <!-- ë‚ ì”¨ ë° ë¡œê·¸ì¸ -->
            <div class="d-flex align-items-center">
                <!-- ë‚ ì”¨ ì •ë³´ -->
                <div id="weather" class="d-flex align-items-center me-3" style="font-size: 0.9rem; color: #777;">
                    <img src="" alt="ë‚ ì”¨ ì•„ì´ì½˜" id="weather-icon" style="width: 24px; height: 24px; margin-right: 8px; display: none;" />
                    <span id="weather-text" style="margin-right: 12px;">ë‚ ì”¨ ë¡œë”© ì¤‘...</span>
                    <div id="weather-desc" style="font-size: 0.9rem; color: #555; white-space: nowrap;"></div>
                </div>

                <!-- ë¡œê·¸ì¸ ìƒíƒœ -->
                <div class="d-flex">
                    <div th:if="${session.user == null}">
                        <a class="nav-link px-3 py-1 rounded" th:href="@{/login}" style="color: #555; font-size: 1rem; font-weight: 500;">
                            ğŸ”‘ ë¡œê·¸ì¸
                        </a>
                    </div>
                    <div th:if="${session.user != null}">
                        <a class="nav-link px-3 py-1 rounded" th:href="@{/user/mypage}" style="color: #555; font-size: 1rem; font-weight: 500;">
                            ğŸ‘¤ ë§ˆì´í˜ì´ì§€
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- JavaScript ì½”ë“œ -->
    <script>
        const weatherApiKey = "ecfb306cc941bc4787bd35238591a73e"; // API í‚¤
        const city = "Seoul";

        async function fetchWeather() {
            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&appid=${weatherApiKey}`);
                if (!response.ok) {
                    throw new Error("ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                }

                const data = await response.json();
                const temp = Math.round(data.main.temp);
                const weatherDesc = data.weather[0].description;
                const icon = data.weather[0].icon;

                // ì‚°ì±… ì¶”ì²œ ë©”ì‹œì§€
                let walkMessage = "ì˜¤ëŠ˜ ë¿Œë¦°ê³¼ ì‚°ì±…í•˜ê¸° ë”± ì¢‹ì€ ë‚ ì”¨ì—ìš”!";
                if (temp < 5) {
                    walkMessage = "ì¡°ê¸ˆ ì¶¥ë„¤ìš”! ë¿Œë¦°ì´ì™€ ì§§ì€ ì‚°ì±… ì¶”ì²œ! â„ï¸";
                } else if (temp > 30) {
                    walkMessage = "ë”ìš´ ë‚ ì”¨ë„¤ìš”. ì‚°ì±…ì€ í”¼í•˜ì„¸ìš”! ğŸ¥µ";
                } else if (weatherDesc.includes("rain")) {
                    walkMessage = "ë¹„ê°€ ì˜¤ê³  ìˆì–´ìš”. ì‹¤ë‚´ ë†€ì´ ì¶”ì²œ! â˜”ï¸";
                }

                // ë‚ ì”¨ ì •ë³´ ì—…ë°ì´íŠ¸
                document.getElementById("weather-icon").src = `https://openweathermap.org/img/wn/${icon}.png`;
                document.getElementById("weather-icon").style.display = "inline-block";
                document.getElementById("weather-text").innerText = `${city}: ${temp}Â°C`;
                document.getElementById("weather-desc").innerText = walkMessage;
            } catch (error) {
                document.getElementById("weather-text").innerText = "ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
                document.getElementById("weather-desc").innerText = "";
            }
        }

        document.addEventListener("DOMContentLoaded", fetchWeather);
    </script>
</div>